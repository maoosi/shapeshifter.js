/*!
* shapeshifter.js 1.0.0 - JavaScript library to mask images and create custom shapes.
*
* @author       maoosi <hello@sylvainsimao.fr>
* @homepage     https://github.com/maoosi/shapeshifter.js#readme
* @copyright    Copyright (c) 2017 maoosi <hello@sylvainsimao.fr>
* @license      MIT
* @version      1.0.0
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Shapeshifter=i()}(this,function(){"use strict";var t=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},i=function(){function i(t,i){return h[t]=h[t]||[],h[t].push(i),this}function e(t,e){return e._once=!0,i(t,e),this}function s(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i?h[t].splice(h[t].indexOf(i),1):delete h[t],this}function n(t){for(var i=this,e=arguments.length,n=Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];var o=h[t]&&h[t].slice();return o&&o.forEach(function(e){e._once&&s(t,e),e.apply(i,n)}),this}var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=Object.create(null);return t({},a,{on:i,once:e,off:s,emit:n})},e=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),n=function(){function t(){e(this,t),this.waitQueue=[],this.waitExecution=!1}return s(t,[{key:"handle",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.waitQueue.push({func:i,timeout:this._isAsyncFunc(i)?"async":e}),this.waitExecution||this._next(),t}},{key:"pause",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return this.handle(t,e,i)}},{key:"_isAsyncFunc",value:function(t){return t.toString().search("done()")>-1}},{key:"_exec",value:function(t){var i=this;t.call(this,function(){i._next()})}},{key:"_next",value:function(){var t=this;if(this.waitQueue.length>0){this.waitExecution=!0;var i=this.waitQueue.shift(),e=i.func,s=i.timeout;"async"===s?this._exec(e):s!==!1?(this._exec(e),setTimeout(function(){t._next()},s)):(this._exec(e),this._next())}else this.waitExecution=!1}}]),t}(),a=function(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];return new(Function.prototype.bind.apply(n,[null].concat(i)))},h=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),r=function(){function t(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,t),this.options={color:s.color||"#fff",image:s.image||!1,shadow:s.shadow||!1},this.selector="string"==typeof e?document.querySelector(e):e,this.loaded=!1,this.shape=!1,this.emitter=i(),this.waitter=a(),this}return o(t,[{key:"init",value:function(){var t=this;return this.waitter.handle(this,function(){t._createWrapper(),t._bindEvents(),t._preload()})}},{key:"shift",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.waitter.handle(this,function(){i.shape=t?t:[[0,0],[1,0],[1,1],[0,1]],i.mode=e,i.shadow=s,i._draw()})}},{key:"wait",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.waitter.handle(this,function(){t.emitter.emit("wait",i)},i)}},{key:"destroy",value:function(){var t=this;return this.waitter.handle(this,function(){t._unbindEvents(),t.wrapper.parentNode.removeChild(t.wrapper),t.emitter.emit("destroy"),t.emitter.off("destroy"),t.emitter.off("load"),t.emitter.off("wait")})}},{key:"on",value:function(){var t;return(t=this.emitter).on.apply(t,arguments)}},{key:"off",value:function(){var t;return(t=this.emitter).off.apply(t,arguments)}},{key:"_throttle",value:function(t,i){var e=this,s=arguments,n=void 0,a=void 0;return function(){var h=e,o=+new Date,r=s;n&&o<n+i?(clearTimeout(a),a=setTimeout(function(){n=o,t.apply(h,r)},i)):(n=o,t.apply(h,r))}}},{key:"_resize",value:function(){this.canvas.width=this.selector.clientWidth,this.canvas.height=this.selector.clientHeight,this.options.shadow&&(this.shadowCanvas.width=this.canvas.width,this.shadowCanvas.height=this.canvas.height),this._draw()}},{key:"_bindEvents",value:function(){var t=this;this.resize=this._throttle(function(){t._resize()},150),window.addEventListener("resize",this.resize,!1)}},{key:"_unbindEvents",value:function(){window.removeEventListener("resize",this.resize,!1)}},{key:"_createWrapper",value:function(){this.wrapper=document.createElement("div"),this.wrapper.setAttribute("style","width:100%;height:100%;position:relative;overflow:visible;"),this.selector.appendChild(this.wrapper),this._createMainCanvas(),this.options.shadow&&this._createShadowCanvas()}},{key:"_createMainCanvas",value:function(){this.canvas=document.createElement("canvas"),this.wrapper.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.selector.clientWidth,this.canvas.height=this.selector.clientHeight}},{key:"_createShadowCanvas",value:function(){var t=this.options.shadow.translateX||"0",i=this.options.shadow.translateY||"0",e=this.options.shadow.blur?this.options.shadow.blur:0;this.shadowCanvas=document.createElement("canvas"),this.shadowCanvas.setAttribute("style","top:0;left:0;position:absolute;z-index:-1;-webkit-transform:translateY("+i+") translateX("+t+");-ms-transform:translateY("+i+") translateX("+t+");transform:translateY("+i+") translateX("+t+");-webkit-filter:blur("+e+"px);filter:blur("+e+"px);"),this.wrapper.appendChild(this.shadowCanvas),this.shadowCtx=this.shadowCanvas.getContext("2d"),this.shadowCanvas.width=this.selector.clientWidth,this.shadowCanvas.height=this.selector.clientHeight}},{key:"_preload",value:function(){var t=this;this.options.image?(this.image=new Image,this.image.onload=function(){t.loaded||(t.loaded=!0,t.emitter.emit("load",t.image))},this.image.src=this.options.image):this.loaded||(this.loaded=!0,this.emitter.emit("load",this.image))}},{key:"_setDimensions",value:function(){var t=this.selector.clientWidth,i=this.selector.clientHeight,e=t/i;if(this.options.image){var s=this.image.naturalWidth,n=this.image.naturalHeight,a=s/n;a>=e?(this.displayHeight=i,this.displayWidth=s*i/n):(this.displayWidth=t,this.displayHeight=n*t/s)}else this.displayHeight=i,this.displayWidth=t}},{key:"_draw",value:function(){this._drawMain(),this.options.shadow&&this._drawShadow()}},{key:"_drawMain",value:function(){if(this._setDimensions(),this.ctx.clearRect(0,0,this.displayWidth,this.displayHeight),this.ctx=this._clipShape(this.canvas,this.ctx,this.shape),this.options.image&&"color"!==this.mode){var t=(this.canvas.width-this.displayWidth)*-1,i=(this.canvas.height-this.displayHeight)*-1;this.ctx.drawImage(this.image,t,i,this.image.naturalWidth,this.image.naturalHeight,0,0,this.displayWidth,this.displayHeight)}else this.ctx.fillStyle=this.options.color,this.ctx.fillRect(0,0,this.displayWidth,this.displayHeight);this.ctx.restore()}},{key:"_drawShadow",value:function(){this.shadowCtx.clearRect(0,0,this.displayWidth,this.displayHeight),this.shadow&&(this.shadowCtx=this._clipShape(this.shadowCanvas,this.shadowCtx,this.shape,this.shadowBlur),this.shadowCtx.fillStyle=this.options.shadow.color,this.shadowCtx.fillRect(0,0,this.displayWidth,this.displayHeight),this.shadowCtx.restore())}},{key:"_clipShape",value:function(t,i,e){var s=t.width,n=t.height,a=e;i.save(),i.beginPath(),i.moveTo(s*a[0][0],n*a[0][1]);for(var h=1;h<a.length;h++)i.lineTo(s*a[h][0],n*a[h][1]);return i.closePath(),i.clip(),i}}]),t}();return r});
//# sourceMappingURL=shapeshifter.js.map
