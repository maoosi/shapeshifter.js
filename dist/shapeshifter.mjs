/*!
* @maoosi/shapeshifter 1.0.2 - JS library to easily shift between different masking shapes.
*
* @author       maoosi <hello@sylvainsimao.fr>
* @homepage     https://github.com/maoosi/shapeshifter.js#readme
* @copyright    Copyright (c) 2017 maoosi <hello@sylvainsimao.fr>
* @license      MIT
* @version      1.0.2
*/
var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},knot=function(){function t(t,e){return n[t]=n[t]||[],n[t].push(e),this}function e(e,i){return i._once=!0,t(e,i),this}function i(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?n[t].splice(n[t].indexOf(e),1):delete n[t],this}function a(t){for(var e=this,a=arguments.length,s=Array(a>1?a-1:0),h=1;h<a;h++)s[h-1]=arguments[h];var r=n[t]&&n[t].slice();return r&&r.forEach(function(a){a._once&&i(t,a),a.apply(e,s)}),this}var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.create(null);return _extends({},s,{on:t,once:e,off:i,emit:a})},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),Wait=function(){function t(){classCallCheck(this,t),this.waitQueue=[],this.waitExecution=!1}return createClass(t,[{key:"handle",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.waitQueue.push({func:e,timeout:this._isAsyncFunc(e)?"async":i}),this.waitExecution||this._next(),t}},{key:"pause",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return this.handle(t,i,e)}},{key:"_isAsyncFunc",value:function(t){return t.toString().search("done()")>-1}},{key:"_exec",value:function(t){var e=this;t.call(this,function(){e._next()})}},{key:"_next",value:function(){var t=this;if(this.waitQueue.length>0){this.waitExecution=!0;var e=this.waitQueue.shift(),i=e.func,a=e.timeout;"async"===a?this._exec(i):a!==!1?(this._exec(i),setTimeout(function(){t._next()},a)):(this._exec(i),this._next())}else this.waitExecution=!1}}]),t}(),wait=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(Wait,[null].concat(e)))},classCallCheck$1=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass$1=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),Shapeshifter=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return classCallCheck$1(this,t),this.options={color:i.color||"#fff",image:i.image||!1,shadow:i.shadow||!1},this.selector="string"==typeof e?document.querySelector(e):e,this.loaded=!1,this.shape=!1,this.emitter=knot(),this.waitter=wait(),this}return createClass$1(t,[{key:"init",value:function(){var t=this;return this.waitter.handle(this,function(){t._createWrapper(),t._bindEvents(),t._preload()})}},{key:"shift",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.waitter.handle(this,function(){e.shape=t?t:[[0,0],[1,0],[1,1],[0,1]],e.mode=i,e.shadow=a,e._draw()})}},{key:"wait",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.waitter.handle(this,function(){t.emitter.emit("wait",e)},e)}},{key:"destroy",value:function(){var t=this;return this.waitter.handle(this,function(){t._unbindEvents(),t.wrapper.parentNode.removeChild(t.wrapper),t.loaded=!1,t.emitter.emit("destroy"),t.emitter.off("destroy"),t.emitter.off("ready"),t.emitter.off("wait")})}},{key:"on",value:function(){var t;return(t=this.emitter).on.apply(t,arguments)}},{key:"off",value:function(){var t;return(t=this.emitter).off.apply(t,arguments)}},{key:"_throttle",value:function(t,e){var i=this,a=arguments,s=void 0,n=void 0;return function(){var h=i,r=+new Date,o=a;s&&r<s+e?(clearTimeout(n),n=setTimeout(function(){s=r,t.apply(h,o)},e)):(s=r,t.apply(h,o))}}},{key:"_resize",value:function(){this.canvas.width=this.selector.clientWidth,this.canvas.height=this.selector.clientHeight,this.options.shadow&&(this.shadowCanvas.width=this.canvas.width,this.shadowCanvas.height=this.canvas.height),this._draw()}},{key:"_bindEvents",value:function(){var t=this;this.resize=this._throttle(function(){t._resize()},150),window.addEventListener("resize",this.resize,!1)}},{key:"_unbindEvents",value:function(){window.removeEventListener("resize",this.resize,!1)}},{key:"_createWrapper",value:function(){this.wrapper=document.createElement("div"),this.wrapper.setAttribute("style","width:100%;height:100%;position:relative;overflow:visible;"),this.selector.appendChild(this.wrapper),this._createMainCanvas(),this.options.shadow&&this._createShadowCanvas()}},{key:"_createMainCanvas",value:function(){this.canvas=document.createElement("canvas"),this.wrapper.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.selector.clientWidth,this.canvas.height=this.selector.clientHeight}},{key:"_createShadowCanvas",value:function(){var t=this.options.shadow.translateX||"0",e=this.options.shadow.translateY||"0",i=this.options.shadow.blur?this.options.shadow.blur:0;this.shadowCanvas=document.createElement("canvas"),this.shadowCanvas.setAttribute("style","top:0;left:0;position:absolute;z-index:-1;-webkit-transform:translateY("+e+") translateX("+t+");-ms-transform:translateY("+e+") translateX("+t+");transform:translateY("+e+") translateX("+t+");-webkit-filter:blur("+i+"px);filter:blur("+i+"px);"),this.wrapper.appendChild(this.shadowCanvas),this.shadowCtx=this.shadowCanvas.getContext("2d"),this.shadowCanvas.width=this.selector.clientWidth,this.shadowCanvas.height=this.selector.clientHeight}},{key:"_preload",value:function(){var t=this;this.options.image?(this.image=new Image,this.image.onload=function(){t.loaded||(t.loaded=!0,t.emitter.emit("ready",t.image))},this.image.src=this.options.image):this.loaded||(this.loaded=!0,this.emitter.emit("ready",this.image))}},{key:"_setDimensions",value:function(){var t=this.selector.clientWidth,e=this.selector.clientHeight,i=t/e;if(this.options.image){var a=this.image.naturalWidth,s=this.image.naturalHeight,n=a/s;n>=i?(this.displayHeight=e,this.displayWidth=a*e/s):(this.displayWidth=t,this.displayHeight=s*t/a)}else this.displayHeight=e,this.displayWidth=t}},{key:"_draw",value:function(){this._drawMain(),this.options.shadow&&this._drawShadow()}},{key:"_drawMain",value:function(){if(this._setDimensions(),this.ctx.clearRect(0,0,this.displayWidth,this.displayHeight),this.ctx=this._clipShape(this.canvas,this.ctx,this.shape),this.options.image&&"color"!==this.mode){var t=(this.displayWidth-this.canvas.width)/2*-1,e=(this.displayHeight-this.canvas.height)/2*-1;this.ctx.drawImage(this.image,0,0,this.image.naturalWidth,this.image.naturalHeight,t,e,this.displayWidth,this.displayHeight)}else this.ctx.fillStyle=this.options.color,this.ctx.fillRect(0,0,this.displayWidth,this.displayHeight);this.ctx.restore()}},{key:"_drawShadow",value:function(){this.shadowCtx.clearRect(0,0,this.displayWidth,this.displayHeight),this.shadow&&(this.shadowCtx=this._clipShape(this.shadowCanvas,this.shadowCtx,this.shape,this.shadowBlur),this.shadowCtx.fillStyle=this.options.shadow.color,this.shadowCtx.fillRect(0,0,this.displayWidth,this.displayHeight),this.shadowCtx.restore())}},{key:"_clipShape",value:function(t,e,i){var a=t.width,s=t.height,n=i;e.save(),e.beginPath(),e.moveTo(a*n[0][0],s*n[0][1]);for(var h=1;h<n.length;h++)e.lineTo(a*n[h][0],s*n[h][1]);return e.closePath(),e.clip(),e}}]),t}();export default Shapeshifter;
//# sourceMappingURL=shapeshifter.mjs.map
